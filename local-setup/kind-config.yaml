# three node (two workers) cluster config
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
  - role: control-plane
    extraPortMappings:
    # node-exporter
    - containerPort: 9100
      hostPort: 9100
      # optional: set the bind address on the host
      # 0.0.0.0 is the current default
      #listenAddress: "127.0.0.1"
      # optional: set the protocol to one of TCP, UDP, SCTP.
      # TCP is the default
      #protocol: TCP
    kubeadmConfigPatches:
    - |
      kind: ClusterConfiguration
      apiServer:
          extraArgs:
            service-node-port-range: 2000-32767
  - role: worker
    extraPortMappings:
    # prometheus port
    - containerPort: 5050
      hostPort: 5050
      # optional: set the bind address on the host
      # 0.0.0.0 is the current default
      listenAddress: "127.0.0.1"
      # optional: set the protocol to one of TCP, UDP, SCTP.
      # TCP is the default
      protocol: TCP

    # grafana port
    - containerPort: 8000
      hostPort: 8000
      # optional: set the bind address on the host
      # 0.0.0.0 is the current default
      listenAddress: "127.0.0.1"
      # optional: set the protocol to one of TCP, UDP, SCTP.
      # TCP is the default
      protocol: TCP

    # node-exporter
    - containerPort: 9100
      hostPort: 9200
      # optional: set the bind address on the host
      # 0.0.0.0 is the current default
      #listenAddress: "127.0.0.1"
      # optional: set the protocol to one of TCP, UDP, SCTP.
      # TCP is the default
      #protocol: TCP
 # - role: worker
